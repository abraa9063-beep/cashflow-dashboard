<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <!-- 1Ô∏è‚É£ META DADOS (OBRIGAT√ìRIOS) -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí∞ CashFlow Dashboard</title>
    
    <!-- 2Ô∏è‚É£ FAVICON (√≠cone do site) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üí∞</text></svg>">
    
    <!-- 3Ô∏è‚É£ FONTE DO GOOGLE (deixa mais bonito) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- 4Ô∏è‚É£ CHART.JS (para gr√°ficos) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- 5Ô∏è‚É£ SEU CSS -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- ============================================ -->
    <!-- üöÄ √ÅREA DE CARREGAMENTO (aparece primeiro) -->
    <!-- ============================================ -->
    <div id="loading" class="loading-overlay">
        <div class="loading-spinner"></div>
        <p>Carregando CashFlow...</p>
    </div>
    
    <!-- ============================================ -->
    <!-- üì± APLICATIVO (aparece depois do carregamento) -->
    <!-- ============================================ -->
    <div id="app" style="display: none;">
        
        <!-- ========== CABE√áALHO ========== -->
        <header class="dashboard-header">
            <div class="logo">
                <h1>üí∞ CashFlow</h1>
                <p class="subtitle">Controle suas finan√ßas</p>
            </div>
            
            <div class="user-info">
                <span id="userName">Carregando...</span>
                <button onclick="logout()" class="btn-logout">Sair</button>
            </div>
        </header>
        
        <!-- ========== ESTAT√çSTICAS ========== -->
        <section class="stats-section">
            <div class="stats-grid">
                <!-- Entradas -->
                <div class="stat-card entrada">
                    <div class="stat-icon">üí∞</div>
                    <div class="stat-info">
                        <div class="stat-label">Entradas</div>
                        <div class="stat-value" id="totalEntradas">R$ 0,00</div>
                    </div>
                </div>
                
                <!-- Sa√≠das -->
                <div class="stat-card saida">
                    <div class="stat-icon">üí∏</div>
                    <div class="stat-info">
                        <div class="stat-label">Sa√≠das</div>
                        <div class="stat-value" id="totalSaidas">R$ 0,00</div>
                    </div>
                </div>
                
                <!-- Saldo -->
                <div class="stat-card saldo">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-info">
                        <div class="stat-label">Saldo</div>
                        <div class="stat-value" id="totalSaldo">R$ 0,00</div>
                    </div>
                </div>
                
                <!-- Transa√ß√µes -->
                <div class="stat-card transacoes">
                    <div class="stat-icon">üìã</div>
                    <div class="stat-info">
                        <div class="stat-label">Transa√ß√µes</div>
                        <div class="stat-value" id="totalTransacoes">0</div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- ========== BOT√ïES DE A√á√ÉO ========== -->
        <section class="actions-section">
            <button class="btn-action btn-primary" onclick="showTransactionForm('entrada')">
                <span class="btn-icon">‚ûï</span>
                <span class="btn-text">Nova Entrada</span>
            </button>
            
            <button class="btn-action btn-danger" onclick="showTransactionForm('saida')">
                <span class="btn-icon">‚ûñ</span>
                <span class="btn-text">Nova Sa√≠da</span>
            </button>
            
            <button class="btn-action btn-secondary" onclick="showRelatorios()">
                <span class="btn-icon">üìä</span>
                <span class="btn-text">Relat√≥rios</span>
            </button>
        </section>
        
        <!-- ========== LISTA DE TRANSA√á√ïES ========== -->
        <section class="transactions-section">
            <div class="section-header">
                <h2>üìã √öltimas Transa√ß√µes</h2>
                <div class="filters">
                    <select id="filterType" onchange="carregarTransacoes()">
                        <option value="todos">Todas</option>
                        <option value="entrada">Apenas Entradas</option>
                        <option value="saida">Apenas Sa√≠das</option>
                    </select>
                    
                    <input type="month" id="filterMonth" onchange="carregarTransacoes()">
                </div>
            </div>
            
            <div class="transactions-list" id="transactionsList">
                <!-- As transa√ß√µes ser√£o carregadas aqui pelo JavaScript -->
                <div class="empty-state">
                    <p>üò¥ Nenhuma transa√ß√£o ainda...</p>
                    <button onclick="showTransactionForm('entrada')" class="btn-empty">
                        Adicionar primeira transa√ß√£o
                    </button>
                </div>
            </div>
        </section>
        
        <!-- ========== GR√ÅFICOS ========== -->
        <section class="charts-section">
            <div class="chart-container">
                <h3>üìà Evolu√ß√£o Mensal</h3>
                <div class="chart-wrapper">
                    <canvas id="monthlyChart"></canvas>
                </div>
            </div>
            
            <div class="chart-container">
                <h3>üçï Gastos por Categoria</h3>
                <div class="chart-wrapper">
                    <canvas id="categoryChart"></canvas>
                </div>
            </div>
        </section>
        
        <!-- ========== MODAL PARA NOVA TRANSA√á√ÉO ========== -->
        <div id="transactionModal" class="modal-overlay" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalTitle">Nova Transa√ß√£o</h2>
                    <button class="modal-close" onclick="closeTransactionModal()">√ó</button>
                </div>
                
                <div class="modal-body">
                    <form id="transactionForm" onsubmit="salvarTransacao(event)">
                        <input type="hidden" id="transactionId">
                        <input type="hidden" id="transactionType">
                        
                        <div class="form-group">
                            <label for="valor">Valor (R$)*</label>
                            <input type="number" id="valor" step="0.01" min="0.01" required 
                                   placeholder="0,00" autocomplete="off">
                        </div>
                        
                        <div class="form-group">
                            <label for="descricao">Descri√ß√£o*</label>
                            <input type="text" id="descricao" required 
                                   placeholder="Ex: Sal√°rio, Aluguel, Mercado...">
                        </div>
                        
                        <div class="form-group">
                            <label for="categoria">Categoria*</label>
                            <select id="categoria" required>
                                <option value="">Selecione...</option>
                                <!-- Categorias ser√£o carregadas pelo JavaScript -->
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="data">Data*</label>
                            <input type="date" id="data" required>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn-cancel" onclick="closeTransactionModal()">
                                Cancelar
                            </button>
                            <button type="submit" class="btn-save">
                                Salvar Transa√ß√£o
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ============================================ -->
    <!-- üì¶ TODOS OS SCRIPTS NO FINAL DO BODY -->
    <!-- ============================================ -->
    
    <!-- 1Ô∏è‚É£ FIREBASE SDK (PRIMEIRO!) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    
    <!-- 2Ô∏è‚É£ SUA CONFIGURA√á√ÉO DO FIREBASE -->
    <script src="js/firebase-config.js"></script>
    
    <!-- 3Ô∏è‚É£ SEUS SCRIPTS -->
    <script src="js/auth.js"></script>
    <script src="js/transactions.js"></script>
    <script src="js/dashboard.js"></script>
    
    <!-- 4Ô∏è‚É£ INICIALIZA√á√ÉO -->
    <script>
        // Quando a p√°gina terminar de carregar
        document.addEventListener('DOMContentLoaded', function() {
            console.log("üìÑ P√°gina carregada!");
            
            // Verificar se usu√°rio est√° logado
            auth.onAuthStateChanged(function(user) {
                if (user) {
                    // Usu√°rio logado - mostrar dashboard
                    console.log("üë§ Usu√°rio logado:", user.email);
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('app').style.display = 'block';
                    
                    // Carregar dados do usu√°rio
                    carregarDadosUsuario(user.uid);
                    
                    // Carregar transa√ß√µes
                    carregarTransacoes();
                    
                } else {
                    // N√£o est√° logado - redirecionar para login
                    console.log("‚ùå Usu√°rio n√£o logado, redirecionando...");
                    window.location.href = 'login.html';
                }
            });
        });
        
        // Fun√ß√£o para carregar dados do usu√°rio
        async function carregarDadosUsuario(userId) {
            try {
                const userDoc = await db.collection('usuarios').doc(userId).get();
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    document.getElementById('userName').textContent = userData.nome || userData.email;
                }
            } catch (error) {
                console.error("Erro ao carregar dados do usu√°rio:", error);
            }
        }
        
        // Fun√ß√£o de logout
        function logout() {
            if (confirm("Tem certeza que deseja sair?")) {
                auth.signOut()
                    .then(() => {
                        window.location.href = 'login.html';
                    })
                    .catch(error => {
                        alert("Erro ao fazer logout: " + error.message);
                    });
            }
        }
        
        // Fun√ß√µes que ser√£o implementadas nos outros arquivos
        function showTransactionForm(tipo) {
            alert("Esta fun√ß√£o ser√° implementada em transactions.js");
        }
        
        function closeTransactionModal() {
            document.getElementById('transactionModal').style.display = 'none';
        }
        
        function salvarTransacao(event) {
            event.preventDefault();
            alert("Salvando transa√ß√£o...");
        }
        
        function carregarTransacoes() {
            alert("Carregando transa√ß√µes...");
        }
        
        function showRelatorios() {
            alert("Mostrando relat√≥rios...");
        }
    </script>
</body>
</html>